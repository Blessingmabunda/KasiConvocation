{"version":3,"file":"index.umd.js","sources":["../src/utils.js","../src/drawing-pane.js","../src/events.js","../src/control.js","../src/index.js"],"sourcesContent":["import { Browser, DomUtil } from 'leaflet';\nimport styles from './styles.module.css';\n\nexport function toCamelCase(name) {\n  return name\n    .split('-')\n    .map((s, index) => (index === 0 ? s : `${s[0].toUpperCase()}${s.substring(1)}`))\n    .join('');\n}\n\nexport function cls(name, additionalClasses = '') {\n  const clsName = toCamelCase(name);\n  if (styles[clsName]) {\n    return additionalClasses\n      ? `${styles[clsName]} ${name} ${additionalClasses}`\n      : `${styles[clsName]} ${name}`;\n  }\n  // Fallback to just return name and maybe additional classes\n  return additionalClasses ? `${name} ${additionalClasses}` : name;\n}\n\nexport function insertAfter(newNode, referenceNode) {\n  referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);\n}\n\n/**\n * Like original DomUtil.setPosition, but takes an optional offset\n * @param {DOMElement} el\n * @param {Point} point\n */\nexport function setPosition(el, point, offset = null) {\n  const nextPoint = offset ? point.add(offset) : point;\n  el._leaflet_pos = nextPoint;\n\n  if (Browser.any3d) {\n    DomUtil.setTransform(el, nextPoint);\n  } else {\n    el.style.left = nextPoint.x + 'px';\n    el.style.top = nextPoint.y + 'px';\n  }\n}\n\nexport const CLICK_EVT = Browser.mobile ? 'touchend' : 'click';\n\n// This still needed due to bad Leaflet bug on Safari. See https://github.com/Leaflet/Leaflet/issues/7255\nexport function isTrustedEvent(event) {\n  return event.isTrusted || window.Cypress;\n}\n","import { DomUtil, Point } from 'leaflet';\nimport { cls, insertAfter, setPosition, CLICK_EVT, isTrustedEvent } from './utils';\n\nexport const PANE_NAME = 'area-draw-selection';\n\nfunction drawingPaneContainer(options) {\n  const { active, fadeOnActivation } = options;\n  const drawPane = DomUtil.create(\n    'div',\n    cls(\n      'leaflet-map-overlay-pane',\n      `leaflet-pane${active ? '' : ' inactive'}${fadeOnActivation ? ' fading-enabled' : ''}`\n    )\n  );\n  return drawPane;\n}\n\nexport function createPane(map, options) {\n  const standardPanesContainer = map.getContainer().querySelector('.leaflet-map-pane');\n  const overlayPanesContainer = drawingPaneContainer(options);\n  insertAfter(overlayPanesContainer, standardPanesContainer);\n  const pane = map.createPane(PANE_NAME, overlayPanesContainer);\n  const handler = (event) => {\n    // Non-sense, but required on Safari. Probably related to https://github.com/Leaflet/Leaflet/issues/7255\n    if (!isTrustedEvent(event)) {\n      return;\n    }\n    event.stopPropagation();\n    map.fire('as:point-add', event);\n  };\n  pane.addEventListener(CLICK_EVT, handler);\n  return pane;\n}\n\nexport function addEndClickArea(control, [x, y]) {\n  const map = control.getMap();\n  const pane = map.getPane(PANE_NAME);\n  const marker = DomUtil.create('div', cls('end-selection-area'), pane);\n  const bbox = marker.getBoundingClientRect();\n  marker.setAttribute('role', 'button');\n  const handler = (event) => {\n    // Non-sense, but required on Safari. Probably related to https://github.com/Leaflet/Leaflet/issues/7255\n    if (!isTrustedEvent(event)) {\n      return;\n    }\n    event.stopPropagation();\n    map.fire('as:creation-end');\n  };\n  marker.addEventListener(CLICK_EVT, handler, {\n    once: true,\n  });\n  marker.addEventListener('mouseenter', control.hoverClosePoint.bind(control));\n  marker.addEventListener('mouseleave', control.outClosePoint.bind(control));\n  setPosition(marker, new Point(x, y), new Point(-bbox.width / 2, -bbox.height / 2));\n}\n\nexport function removeEndClickArea(control) {\n  const map = control.getMap();\n  const pane = map.getPane(PANE_NAME);\n  const marker = pane.querySelector('.end-selection-area');\n  if (marker) {\n    marker.remove();\n  }\n}\n","import { DivIcon, Marker, Point, Polygon, Polyline, DomEvent, LayerGroup } from 'leaflet';\nimport { cls, isTrustedEvent, CLICK_EVT } from './utils';\nimport { addEndClickArea, removeEndClickArea } from './drawing-pane';\n\nfunction doNothingHandler(event) {\n  event.originalEvent.preventDefault();\n  event.originalEvent.stopPropagation();\n}\n\n/**\n * Event handler reacting to an add point action\n * @param {MouseEvent|TouchEvent} event\n */\nexport function onAddPoint(event) {\n  // Default behavior while dragging\n  if (this.mapMoving) {\n    return;\n  }\n  const map = this.getMap();\n  let { clientX, clientY } = event;\n  // Touch device\n  if (clientX === undefined && clientY === undefined) {\n    const touch = event.changedTouches[0];\n    clientX = touch.clientX;\n    clientY = touch.clientY;\n  }\n  // We were drawing a rect, so we don't perform the canonical action and we stop here\n  if (this.rectDrawing && this.rectDrawEnd !== null) {\n    map.fire('as:dragging-rect-end');\n    return;\n  }\n\n  const { index = null } = event;\n  const container = map.getContainer();\n  const bbox = container.getBoundingClientRect();\n  const x = clientX - bbox.left;\n  const y = clientY - bbox.top;\n  if (this.markers.length === 0) {\n    // this is the first point: let's add a sensible click area on the pane too\n    addEndClickArea(this, [x, y]);\n  }\n  const point = new Point(x, y);\n  const icon = new DivIcon({\n    className: cls('area-select-marker'),\n    iconSize: [16, 16],\n  });\n  const marker = new Marker(map.containerPointToLatLng(point), {\n    icon,\n    draggable: true,\n  });\n  const _onMarkerDrag = onMarkerDrag.bind(this);\n  marker.on('drag', _onMarkerDrag(index === null ? this.markers.length : index));\n  marker.on('dragstart', (event) => {\n    event.target.getElement().classList.add('active');\n  });\n  marker.on('dragend', (event) => {\n    event.target.getElement().classList.remove('active');\n    requestAnimationFrame(() => {\n      this.onPolygonReady();\n    });\n  });\n  const newEdge = {\n    marker,\n    index,\n  };\n  marker.on(\n    'dblclick',\n    ((length) => (event) => {\n      event.originalEvent.stopPropagation();\n      map.fire('as:marker-remove', {\n        ...newEdge,\n        index: index === null ? length : index,\n      });\n    })(this.markers.length)\n  );\n  marker.on(CLICK_EVT, doNothingHandler);\n  marker.addTo(map);\n  map.fire('as:marker-add', newEdge);\n  // If this point as not been added at the end, we need to update even handlers HOC params to update index\n  if (index !== null) {\n    for (let i = index + 1; i < this.markers.length; i++) {\n      this.markers[i].marker.off('drag');\n      this.markers[i].marker.on('drag', _onMarkerDrag(i));\n      this.markers[i].marker.off(CLICK_EVT);\n      this.markers[i].marker.on(CLICK_EVT, doNothingHandler);\n      this.markers[i].marker.off('dblclick');\n      this.markers[i].marker.on('dblclick', (event) => {\n        map.fire('as:marker-remove', {\n          ...this.markers[i],\n          index: i,\n        });\n      });\n    }\n  }\n}\n\nexport function onAddMarker({ index = null, ...rest }) {\n  const map = this.getMap();\n  const edge = {\n    marker: rest.marker,\n  };\n  const { markers } = this;\n  if (index === null) {\n    markers.push(edge);\n  } else {\n    markers.splice(index, 0, edge);\n  }\n  const enoughPoints = markers.length >= 3;\n  if (this.phase === 'draw') {\n    if (!enoughPoints) {\n      markers.forEach(({ marker }) => {\n        const icon = marker.getIcon();\n        icon.options.className = cls('area-select-marker', 'invalid');\n        marker.setIcon(icon);\n      });\n    } else if (markers.length === 3) {\n      // Restore colors\n      markers.forEach(({ marker }, index) => {\n        const icon = marker.getIcon();\n        icon.options.className = cls('area-select-marker', index === 0 ? 'start-marker' : null);\n        marker.setIcon(icon);\n      });\n    }\n  }\n  map.fire('as:update-polygon');\n  if (this.phase === 'adjust') {\n    map.fire('as:update-ghost-points');\n    this.onPolygonReady();\n  }\n\n  if (this.phase === 'draw') {\n    // close line\n    if (this.closeLine) {\n      map.removeLayer(this.closeLine);\n    }\n    if (enoughPoints) {\n      this.closeLine = new Polyline(\n        [markers[0].marker.getLatLng(), markers[markers.length - 1].marker.getLatLng()],\n        {\n          weight: 3,\n          color: '#c0c0c0',\n          className: 'areaCloseLine',\n        }\n      );\n      map.addLayer(this.closeLine);\n    }\n  }\n}\n\nexport function onRemoveMarker({ index = 0 }) {\n  const map = this.getMap();\n  const { markers } = this;\n  const enoughPoints = markers.length > 3;\n  if (!enoughPoints) {\n    return;\n  }\n  const removed = this.markers.splice(index || 0, 1);\n  removed[0].marker.removeFrom(map);\n  map.fire('as:update-polygon');\n  if (this.phase === 'adjust') {\n    map.fire('as:update-ghost-points');\n  }\n  for (let i = index; i < this.markers.length; i++) {\n    this.markers[i].marker.off('drag');\n    this.markers[i].marker.on('drag', onMarkerDrag.bind(this)(i));\n    this.markers[i].marker.off(CLICK_EVT);\n    this.markers[i].marker.on(CLICK_EVT, doNothingHandler);\n    this.markers[i].marker.off('dblclick');\n    this.markers[i].marker.on('dblclick', (event) => {\n      event.originalEvent.stopPropagation();\n      map.fire('as:marker-remove', {\n        ...this.markers[i],\n        index: i,\n      });\n    });\n  }\n  this.onPolygonReady();\n}\n\n/**\n * Refresh the polygon on the map\n */\nexport function onUpdatePolygon() {\n  const map = this.getMap();\n  const { markers } = this;\n  const enoughPoints = markers.length >= 3;\n  const polygon = new Polygon(\n    markers.map(({ marker }) => {\n      return marker.getLatLng();\n      // return map.containerPointToLatLng(point);\n    }),\n    {\n      color: enoughPoints ? 'rgb(45, 123, 200)' : 'rgba(220, 53, 69, 0.7)',\n      weight: 2,\n      ...(!enoughPoints && { dashArray: '5, 10' }),\n      className: 'drawing-area-poligon',\n    }\n  );\n  polygon.on(CLICK_EVT, (ev) => {\n    DomEvent.stopPropagation(ev);\n  });\n\n  polygon.on('dblclick', (ev) => {\n    // Preventing zoom-on-doubleclick is not working. I'll leave hacky workarounds to user's implementation\n    // See https://stackoverflow.com/questions/15406537/disable-map-zoom-on-circlemarker-double-click-in-leaflet\n    DomEvent.stopPropagation(ev);\n    this.onPolygonDblClick(ev);\n    return false;\n  });\n  if (this.polygon) {\n    map.removeLayer(this.polygon);\n  }\n  this.polygon = polygon;\n  map.addLayer(this.polygon);\n}\n\nexport function onUpdateGhostPoints() {\n  const map = this.getMap();\n  requestAnimationFrame(() => {\n    this.clearGhostMarkers();\n    const { markers, ghostMarkers } = this;\n    markers.forEach((currentMarker, index) => {\n      const nextMarker = markers[index + 1] ? markers[index + 1] : markers[0];\n      const currentLatLng = currentMarker.marker.getLatLng();\n      const nextLatLng = nextMarker.marker.getLatLng();\n      const point = map.latLngToContainerPoint([\n        (currentLatLng.lat + nextLatLng.lat) / 2,\n        (currentLatLng.lng + nextLatLng.lng) / 2,\n      ]);\n\n      const icon = new DivIcon({\n        className: cls('area-select-ghost-marker'),\n        iconSize: [16, 16],\n      });\n      const marker = new Marker(map.containerPointToLatLng(point), {\n        icon,\n        draggable: true,\n      });\n      const newGhostMarker = {\n        marker,\n      };\n      marker.on(CLICK_EVT, doNothingHandler);\n      marker.on('dblclick', doNothingHandler);\n      marker.on('dragstart', onGhostMarkerDragStart.bind(this)());\n      marker.on('drag', onGhostMarkerDrag.bind(this)(ghostMarkers.length));\n      marker.on('dragend', onGhostMarkerDragEnd.bind(this)(ghostMarkers.length));\n      ghostMarkers.push(newGhostMarker);\n      marker.addTo(map);\n    });\n  });\n}\n\nexport function onPolygonCreationEnd() {\n  const map = this.getMap();\n  // We'll forcly enable the drag on the map (which will be just of the draw pane)\n  map.dragging.enable();\n  map.removeLayer(this.closeLine);\n  this.closeLine = null;\n  // Remove style for the final marker icon\n  this.markers[0].marker.getElement().classList.remove('start-marker');\n  this.setPhase('adjust');\n  map.fire('as:update-ghost-points');\n  this.onPolygonReady();\n  removeEndClickArea(this);\n}\n\n/**\n * Plugin activation (button pressed)\n */\nexport function onActivate(event) {\n  // Non-sense, but required on Safari. Probably related to https://github.com/Leaflet/Leaflet/issues/7255\n  if (!isTrustedEvent(event)) {\n    return;\n  }\n  const map = this.getMap();\n  // storing if the dragging is enabled in the map\n  this._dragStatus = map.dragging._enabled;\n\n  // Let leave to custom callback any call to preventDefault, which will block normal button behaviors\n  // event.preventDefault();\n  event.stopPropagation();\n  event.target.blur();\n  // if current state is active, we need to deactivate\n  const activeState = this.options.active || this.phase === 'adjust';\n  if (activeState) {\n    // Disable dragging if it was enabled before the activation\n    if (!this._dragStatus) {\n      map.dragging.disable();\n    }\n\n    // Calling user's specific event handler\n    this.options.onButtonDeactivate(this.polygon, this, event);\n    if (!event.defaultPrevented) {\n      this.deactivate();\n    }\n  } else {\n    // Calling user's specific event handler\n    this.options.onButtonActivate(this, event);\n    if (!event.defaultPrevented) {\n      this.activate();\n    }\n  }\n}\n\nexport function onMarkerDrag(index) {\n  const map = this.getMap();\n  return (event) => {\n    requestAnimationFrame(() => {\n      map.fire('as:update-polygon');\n      map.fire('as:update-ghost-points');\n    });\n  };\n}\n\nexport function onGhostMarkerDrag(index) {\n  const map = this.getMap();\n  return (event) => {\n    const { latlng } = event;\n    requestAnimationFrame(() => {\n      // Given a ghost point, markers to be used as edges are the one at +0 and +1\n      const firstPoint = this.markers[index];\n      const lastPoint = this.markers[index + 1] ? this.markers[index + 1] : this.markers[0];\n      if (this.ghostPolygon) {\n        map.removeLayer(this.ghostPolygon);\n      }\n      this.ghostPolygon = new Polygon(\n        [firstPoint.marker.getLatLng(), latlng, lastPoint.marker.getLatLng()],\n        {\n          color: 'rgb(45, 123, 200)',\n          weight: 2,\n          opacity: 0.5,\n          fillOpacity: 0.1,\n          dashArray: '5, 10',\n        }\n      );\n      map.addLayer(this.ghostPolygon);\n      map.fire('as:update-polygon');\n    });\n  };\n}\n\nexport function onGhostMarkerDragStart() {\n  return (event) => {\n    event.target.getElement().classList.add('active');\n  };\n}\n\nexport function onGhostMarkerDragEnd(index) {\n  const map = this.getMap();\n  return (event) => {\n    const { target } = event;\n    target.getElement().classList.remove('active');\n    target.removeFrom(map);\n    if (this.ghostPolygon) {\n      map.removeLayer(this.ghostPolygon);\n    }\n    const newPoint = map.latLngToContainerPoint(target.getLatLng());\n    const container = map.getContainer();\n    const bbox = container.getBoundingClientRect();\n    const fakeEvent = {\n      clientX: newPoint.x + bbox.left,\n      clientY: newPoint.y + bbox.top,\n      index: index + 1,\n    };\n    map.fire('as:point-add', fakeEvent);\n  };\n}\n\nexport function onMouseMove(event) {\n  if (!this.mapMoving && this.markers.length === 0 && event.which !== 0 && event.buttons === 1) {\n    const map = this.getMap();\n    if (!this.rectDrawing) {\n      this.rectDrawStart = [event.clientX, event.clientY];\n      const props = {\n        weight: 2,\n        color: '#8B4513',\n        className: 'rect-progress-line',\n        opacity: 0.6,\n      };\n      this.draggingRect = new LayerGroup()\n        .addLayer(new Polyline([], props))\n        .addLayer(new Polyline([], props))\n        .addTo(map);\n      this.rectDrawing = true;\n      return;\n    }\n    this.rectDrawEnd = [event.clientX, event.clientY];\n    const pointA = [this.rectDrawStart[0], event.clientY];\n    const pointB = [event.clientX, this.rectDrawStart[1]];\n\n    const layers = this.draggingRect.getLayers();\n    layers[0].setLatLngs([\n      map.mouseEventToLatLng({ clientX: this.rectDrawEnd[0], clientY: this.rectDrawEnd[1] }),\n      map.mouseEventToLatLng({ clientX: pointA[0], clientY: pointA[1] }),\n      map.mouseEventToLatLng({ clientX: this.rectDrawStart[0], clientY: this.rectDrawStart[1] }),\n    ]);\n    layers[1].setLatLngs([\n      map.mouseEventToLatLng({ clientX: this.rectDrawEnd[0], clientY: this.rectDrawEnd[1] }),\n      map.mouseEventToLatLng({ clientX: pointB[0], clientY: pointB[1] }),\n      map.mouseEventToLatLng({ clientX: this.rectDrawStart[0], clientY: this.rectDrawStart[1] }),\n    ]);\n  }\n}\n\nexport function onDraggingRectEnd() {\n  this.rectDrawing = false;\n  const vertex1 = { clientX: this.rectDrawStart[0], clientY: this.rectDrawStart[1] };\n  const vertex2 = { clientX: this.rectDrawEnd[0], clientY: this.rectDrawStart[1] };\n  const vertex3 = { clientX: this.rectDrawEnd[0], clientY: this.rectDrawEnd[1] };\n  const vertex4 = { clientX: this.rectDrawStart[0], clientY: this.rectDrawEnd[1] };\n  onAddPoint.bind(this)(vertex1);\n  onAddPoint.bind(this)(vertex2);\n  onAddPoint.bind(this)(vertex3);\n  onAddPoint.bind(this)(vertex4);\n  this._map.fire('as:creation-end');\n  this.rectDrawStart = null;\n  this.rectDrawEnd = null;\n  this.draggingRect.removeFrom(this._map);\n}\n","import { DomUtil, Control, Util, Point, Browser } from 'leaflet';\nimport { createPane, removeEndClickArea, PANE_NAME } from './drawing-pane';\nimport { cls, setPosition } from './utils';\nimport {\n  onActivate,\n  onAddMarker,\n  onAddPoint,\n  onDraggingRectEnd,\n  onMouseMove,\n  onPolygonCreationEnd,\n  onRemoveMarker,\n  onUpdateGhostPoints,\n  onUpdatePolygon,\n} from './events';\n\n// import buttonImage from './images/area-icon.png';\n\nexport const DrawAreaSelection = Control.extend({\n  options: {\n    // activate automatically area selection on plugin load\n    active: false,\n    // partially fade the map when draw phase is activated\n    fadeOnActivation: true,\n    /* ******* callbacks ******* */\n    // callback called when draw phase is complete and at every polygon adjustement\n    onPolygonReady: (polygon, control) => {},\n    // callback called when draw phase is complete and double-click is performed on the final polygon\n    onPolygonDblClick: (polygon, control, event) => {},\n    // callback called when user press the activation button\n    onButtonActivate: (control, event) => {},\n    // callback called when user press the button to deactivate (not called when the plugin deactivate itself automatically)\n    onButtonDeactivate: (polygon, control, event) => {},\n  },\n\n  initialize: function (options = {}) {\n    Util.setOptions(this, options);\n    this._map = null;\n    // lifecycle phases: one of inactive, draw, adjust\n    this.phase = options.active ? 'draw' : 'inactive';\n    this.mapMoving = false;\n    // map if in phase of drawing a rectangle\n    this.rectDrawing = false;\n    // where user started to draw a rect\n    this.rectDrawStart = null;\n    this.rectDrawEnd = null;\n    // the dragging rect, composed by two lines\n    this.draggingRect = null;\n    // edge markers used for drawing, next dragging the polygon\n    this.markers = [];\n    // fake markers used for adding rings to the polygon\n    this.ghostMarkers = [];\n    // The actual polygon draw\n    this.polygon = null;\n    // on drawing phase: a line from the last drawn point to the first ones\n    this.closeLine = null;\n\n    this._mapMoveStart = this._mapMoveStart.bind(this);\n    this._mapMoveEnd = this._mapMoveEnd.bind(this);\n    this._handleMouseMove = this._handleMouseMove.bind(this);\n  },\n\n  onAdd: function (map) {\n    this._container = DomUtil.create('div', cls('leaflet-area-selector-control'));\n    this.activateButton = DomUtil.create('button', '', this._container);\n    // this.activateButton.style.backgroundImage = `url('${buttonImage}')`;\n    this.activateButton.setAttribute('aria-label', 'Draw shape');\n    this.activateButton.setAttribute('aria-describedby', 'draw-panel-help');\n    this.activateButton.addEventListener('click', onActivate.bind(this));\n    this.activateButton.addEventListener('dblclick', (event) => {\n      event.stopPropagation();\n    });\n    this.options.active\n      ? this.activateButton.classList.add('active')\n      : this.activateButton.classList.remove('active');\n    this._map = map;\n    const pane = createPane(map, this.options);\n    this.addUserHelpPanel(pane);\n    map.getContainer().addEventListener('mousemove', this._handleMouseMove);\n    map.on('movestart', this._mapMoveStart);\n    map.on('moveend', this._mapMoveEnd);\n    map.on('as:point-add', onAddPoint.bind(this));\n    map.on('as:marker-add', onAddMarker.bind(this));\n    map.on('as:marker-remove', onRemoveMarker.bind(this));\n    map.on('as:creation-end', onPolygonCreationEnd.bind(this));\n    map.on('as:update-polygon', onUpdatePolygon.bind(this));\n    map.on('as:update-ghost-points', onUpdateGhostPoints.bind(this));\n    map.on('as:dragging-rect-end', onDraggingRectEnd.bind(this));\n    return this._container;\n  },\n\n  onRemove: function (map) {\n    map.getContainer().removeEventListener('mousemove', this._handleMouseMove);\n    map.off('movestart', this._mapMoveStart);\n    map.off('moveend', this._mapMoveEnd);\n    map.off('as:point-add');\n    map.off('as:marker-add');\n    map.off('as:marker-remove');\n    map.off('as:creation-end');\n    map.off('as:update-polygon');\n    map.off('as:update-ghost-points');\n    map.off('as:dragging-rect-end');\n  },\n\n  getMap: function () {\n    return this._map;\n  },\n\n  onPolygonReady: function () {\n    this.options.onPolygonReady(this.polygon, this);\n  },\n\n  onPolygonDblClick: function (ev) {\n    this.options.onPolygonDblClick(this.polygon, this, ev);\n  },\n\n  addUserHelpPanel(pane) {\n    const panel = DomUtil.create('div', cls('draw-pane-help'));\n    panel.setAttribute('id', 'draw-panel-help');\n    panel.setAttribute('role', 'tooltip');\n    const help = `Define a polygon by clicking of the map to define vertexes${\n      Browser.mobile ? `.` : ` or click-and-drag to obtain a rectangular shape.`\n    }`;\n    panel.textContent = help;\n\n    pane.appendChild(panel);\n  },\n\n  setPhase(phase, forceClear = false) {\n    this.phase = phase;\n    this.options.active = phase === 'draw';\n    // If we didn't finished to fill a polygon, let's clear all\n    if (forceClear || this.phase === 'draw') {\n      this.clearGhostMarkers();\n      this.clearMarkers();\n      this.clearPolygon();\n    }\n    const pane = this._map.getPane(PANE_NAME);\n    const container = pane.parentNode;\n    this.options.active\n      ? container.classList.remove('inactive')\n      : container.classList.add('inactive');\n  },\n\n  _mapMoveStart: function () {\n    if (!this.options.active) {\n      return;\n    }\n    this.mapMoving = true;\n  },\n\n  _mapMoveEnd: function () {\n    if (!this.options.active) {\n      return;\n    }\n    const map = this._map;\n    requestAnimationFrame(() => {\n      this.mapMoving = false;\n    });\n    // Re-position end of selection HTML element\n    const pane = map.getPane(PANE_NAME);\n    const touchMarker = pane.querySelector('.end-selection-area');\n    if (touchMarker) {\n      const firstMarker = this.markers[0].marker;\n      const bbox = touchMarker.getBoundingClientRect();\n      const point = map.latLngToContainerPoint(firstMarker.getLatLng());\n      setPosition(touchMarker, point, new Point(-bbox.width / 2, -bbox.height / 2));\n    }\n  },\n\n  hoverClosePoint: function (event) {\n    if (this.markers.length > 2 && this.closeLine) {\n      this.closeLine.removeFrom(this._map);\n    }\n  },\n\n  outClosePoint: function (event) {\n    if (this.closeLine) {\n      this.closeLine.addTo(this._map);\n    }\n  },\n\n  clearMarkers: function () {\n    this.markers.forEach(({ marker }) => {\n      marker.removeFrom(this._map);\n    });\n    this.markers = [];\n  },\n\n  clearGhostMarkers: function () {\n    this.ghostMarkers.forEach(({ marker }) => {\n      marker.removeFrom(this._map);\n    });\n    this.ghostMarkers = [];\n  },\n\n  clearPolygon: function () {\n    this.polygon && this.polygon.removeFrom(this._map);\n    this.polygon = null;\n    this.closeLine && this.closeLine.removeFrom(this._map);\n    this.closeLine = null;\n  },\n\n  deactivate: function () {\n    removeEndClickArea(this);\n    this.activateButton.classList.remove('active');\n    this._map.getContainer().classList.remove('drawing-area');\n    this.setPhase('inactive', true);\n  },\n\n  activate: function () {\n    // When activating the plugin we'll disable dragging temporarely (in case we are drawing a rect)\n    this._map.dragging.disable();\n    this.activateButton.classList.add('active');\n    this._map.getContainer().classList.add('drawing-area');\n    this.setPhase('draw', true);\n  },\n\n  _handleMouseMove: function (event) {\n    if (!this.options.active) {\n      return;\n    }\n    onMouseMove.bind(this)(event);\n  },\n});\n\nexport const drawAreaSelection = function (options = {}) {\n  return new DrawAreaSelection(options);\n};\n","import { Util, Control } from 'leaflet';\nimport { DrawAreaSelection, drawAreaSelection } from './control';\n\nUtil.extend(Control, {\n  DrawAreaSelection,\n  drawAreaSelection,\n});\n\nexport { DrawAreaSelection, drawAreaSelection };\n"],"names":["toCamelCase","name","split","map","s","index","toUpperCase","substring","join","cls","additionalClasses","clsName","styles","insertAfter","newNode","referenceNode","parentNode","insertBefore","nextSibling","setPosition","el","point","offset","nextPoint","add","_leaflet_pos","Browser","any3d","DomUtil","setTransform","style","left","x","top","y","CLICK_EVT","mobile","isTrustedEvent","event","isTrusted","window","Cypress","PANE_NAME","drawingPaneContainer","options","active","fadeOnActivation","drawPane","create","createPane","standardPanesContainer","getContainer","querySelector","overlayPanesContainer","pane","handler","stopPropagation","fire","addEventListener","addEndClickArea","control","getMap","getPane","marker","bbox","getBoundingClientRect","setAttribute","once","hoverClosePoint","bind","outClosePoint","Point","width","height","removeEndClickArea","remove","doNothingHandler","originalEvent","preventDefault","onAddPoint","mapMoving","clientX","clientY","undefined","touch","changedTouches","rectDrawing","rectDrawEnd","container","markers","length","icon","DivIcon","className","iconSize","Marker","containerPointToLatLng","draggable","_onMarkerDrag","onMarkerDrag","on","target","getElement","classList","requestAnimationFrame","onPolygonReady","newEdge","addTo","i","off","onAddMarker","rest","edge","push","splice","enoughPoints","phase","forEach","getIcon","setIcon","closeLine","removeLayer","Polyline","getLatLng","weight","color","addLayer","onRemoveMarker","removed","removeFrom","onUpdatePolygon","polygon","Polygon","dashArray","ev","DomEvent","onPolygonDblClick","onUpdateGhostPoints","clearGhostMarkers","ghostMarkers","currentMarker","nextMarker","currentLatLng","nextLatLng","latLngToContainerPoint","lat","lng","newGhostMarker","onGhostMarkerDragStart","onGhostMarkerDrag","onGhostMarkerDragEnd","onPolygonCreationEnd","dragging","enable","setPhase","onActivate","_dragStatus","_enabled","blur","activeState","disable","onButtonDeactivate","defaultPrevented","deactivate","onButtonActivate","activate","latlng","firstPoint","lastPoint","ghostPolygon","opacity","fillOpacity","newPoint","fakeEvent","onMouseMove","which","buttons","rectDrawStart","props","draggingRect","LayerGroup","pointA","pointB","layers","getLayers","setLatLngs","mouseEventToLatLng","onDraggingRectEnd","vertex1","vertex2","vertex3","vertex4","_map","DrawAreaSelection","Control","extend","initialize","Util","setOptions","_mapMoveStart","_mapMoveEnd","_handleMouseMove","onAdd","_container","activateButton","addUserHelpPanel","onRemove","removeEventListener","panel","help","textContent","appendChild","forceClear","clearMarkers","clearPolygon","touchMarker","firstMarker","drawAreaSelection"],"mappings":"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"}