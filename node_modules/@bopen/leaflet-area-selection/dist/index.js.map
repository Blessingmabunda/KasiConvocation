{"version":3,"file":"index.js","sources":["../src/utils.js","../src/drawing-pane.js","../src/events.js","../src/control.js","../src/index.js"],"sourcesContent":["import { Browser, DomUtil } from 'leaflet';\nimport styles from './styles.module.css';\n\nexport function toCamelCase(name) {\n  return name\n    .split('-')\n    .map((s, index) => (index === 0 ? s : `${s[0].toUpperCase()}${s.substring(1)}`))\n    .join('');\n}\n\nexport function cls(name, additionalClasses = '') {\n  const clsName = toCamelCase(name);\n  if (styles[clsName]) {\n    return additionalClasses\n      ? `${styles[clsName]} ${name} ${additionalClasses}`\n      : `${styles[clsName]} ${name}`;\n  }\n  // Fallback to just return name and maybe additional classes\n  return additionalClasses ? `${name} ${additionalClasses}` : name;\n}\n\nexport function insertAfter(newNode, referenceNode) {\n  referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);\n}\n\n/**\n * Like original DomUtil.setPosition, but takes an optional offset\n * @param {DOMElement} el\n * @param {Point} point\n */\nexport function setPosition(el, point, offset = null) {\n  const nextPoint = offset ? point.add(offset) : point;\n  el._leaflet_pos = nextPoint;\n\n  if (Browser.any3d) {\n    DomUtil.setTransform(el, nextPoint);\n  } else {\n    el.style.left = nextPoint.x + 'px';\n    el.style.top = nextPoint.y + 'px';\n  }\n}\n\nexport const CLICK_EVT = Browser.mobile ? 'touchend' : 'click';\n\n// This still needed due to bad Leaflet bug on Safari. See https://github.com/Leaflet/Leaflet/issues/7255\nexport function isTrustedEvent(event) {\n  return event.isTrusted || window.Cypress;\n}\n","import { DomUtil, Point } from 'leaflet';\nimport { cls, insertAfter, setPosition, CLICK_EVT, isTrustedEvent } from './utils';\n\nexport const PANE_NAME = 'area-draw-selection';\n\nfunction drawingPaneContainer(options) {\n  const { active, fadeOnActivation } = options;\n  const drawPane = DomUtil.create(\n    'div',\n    cls(\n      'leaflet-map-overlay-pane',\n      `leaflet-pane${active ? '' : ' inactive'}${fadeOnActivation ? ' fading-enabled' : ''}`\n    )\n  );\n  return drawPane;\n}\n\nexport function createPane(map, options) {\n  const standardPanesContainer = map.getContainer().querySelector('.leaflet-map-pane');\n  const overlayPanesContainer = drawingPaneContainer(options);\n  insertAfter(overlayPanesContainer, standardPanesContainer);\n  const pane = map.createPane(PANE_NAME, overlayPanesContainer);\n  const handler = (event) => {\n    // Non-sense, but required on Safari. Probably related to https://github.com/Leaflet/Leaflet/issues/7255\n    if (!isTrustedEvent(event)) {\n      return;\n    }\n    event.stopPropagation();\n    map.fire('as:point-add', event);\n  };\n  pane.addEventListener(CLICK_EVT, handler);\n  return pane;\n}\n\nexport function addEndClickArea(control, [x, y]) {\n  const map = control.getMap();\n  const pane = map.getPane(PANE_NAME);\n  const marker = DomUtil.create('div', cls('end-selection-area'), pane);\n  const bbox = marker.getBoundingClientRect();\n  marker.setAttribute('role', 'button');\n  const handler = (event) => {\n    // Non-sense, but required on Safari. Probably related to https://github.com/Leaflet/Leaflet/issues/7255\n    if (!isTrustedEvent(event)) {\n      return;\n    }\n    event.stopPropagation();\n    map.fire('as:creation-end');\n  };\n  marker.addEventListener(CLICK_EVT, handler, {\n    once: true,\n  });\n  marker.addEventListener('mouseenter', control.hoverClosePoint.bind(control));\n  marker.addEventListener('mouseleave', control.outClosePoint.bind(control));\n  setPosition(marker, new Point(x, y), new Point(-bbox.width / 2, -bbox.height / 2));\n}\n\nexport function removeEndClickArea(control) {\n  const map = control.getMap();\n  const pane = map.getPane(PANE_NAME);\n  const marker = pane.querySelector('.end-selection-area');\n  if (marker) {\n    marker.remove();\n  }\n}\n","import { DivIcon, Marker, Point, Polygon, Polyline, DomEvent, LayerGroup } from 'leaflet';\nimport { cls, isTrustedEvent, CLICK_EVT } from './utils';\nimport { addEndClickArea, removeEndClickArea } from './drawing-pane';\n\nfunction doNothingHandler(event) {\n  event.originalEvent.preventDefault();\n  event.originalEvent.stopPropagation();\n}\n\n/**\n * Event handler reacting to an add point action\n * @param {MouseEvent|TouchEvent} event\n */\nexport function onAddPoint(event) {\n  // Default behavior while dragging\n  if (this.mapMoving) {\n    return;\n  }\n  const map = this.getMap();\n  let { clientX, clientY } = event;\n  // Touch device\n  if (clientX === undefined && clientY === undefined) {\n    const touch = event.changedTouches[0];\n    clientX = touch.clientX;\n    clientY = touch.clientY;\n  }\n  // We were drawing a rect, so we don't perform the canonical action and we stop here\n  if (this.rectDrawing && this.rectDrawEnd !== null) {\n    map.fire('as:dragging-rect-end');\n    return;\n  }\n\n  const { index = null } = event;\n  const container = map.getContainer();\n  const bbox = container.getBoundingClientRect();\n  const x = clientX - bbox.left;\n  const y = clientY - bbox.top;\n  if (this.markers.length === 0) {\n    // this is the first point: let's add a sensible click area on the pane too\n    addEndClickArea(this, [x, y]);\n  }\n  const point = new Point(x, y);\n  const icon = new DivIcon({\n    className: cls('area-select-marker'),\n    iconSize: [16, 16],\n  });\n  const marker = new Marker(map.containerPointToLatLng(point), {\n    icon,\n    draggable: true,\n  });\n  const _onMarkerDrag = onMarkerDrag.bind(this);\n  marker.on('drag', _onMarkerDrag(index === null ? this.markers.length : index));\n  marker.on('dragstart', (event) => {\n    event.target.getElement().classList.add('active');\n  });\n  marker.on('dragend', (event) => {\n    event.target.getElement().classList.remove('active');\n    requestAnimationFrame(() => {\n      this.onPolygonReady();\n    });\n  });\n  const newEdge = {\n    marker,\n    index,\n  };\n  marker.on(\n    'dblclick',\n    ((length) => (event) => {\n      event.originalEvent.stopPropagation();\n      map.fire('as:marker-remove', {\n        ...newEdge,\n        index: index === null ? length : index,\n      });\n    })(this.markers.length)\n  );\n  marker.on(CLICK_EVT, doNothingHandler);\n  marker.addTo(map);\n  map.fire('as:marker-add', newEdge);\n  // If this point as not been added at the end, we need to update even handlers HOC params to update index\n  if (index !== null) {\n    for (let i = index + 1; i < this.markers.length; i++) {\n      this.markers[i].marker.off('drag');\n      this.markers[i].marker.on('drag', _onMarkerDrag(i));\n      this.markers[i].marker.off(CLICK_EVT);\n      this.markers[i].marker.on(CLICK_EVT, doNothingHandler);\n      this.markers[i].marker.off('dblclick');\n      this.markers[i].marker.on('dblclick', (event) => {\n        map.fire('as:marker-remove', {\n          ...this.markers[i],\n          index: i,\n        });\n      });\n    }\n  }\n}\n\nexport function onAddMarker({ index = null, ...rest }) {\n  const map = this.getMap();\n  const edge = {\n    marker: rest.marker,\n  };\n  const { markers } = this;\n  if (index === null) {\n    markers.push(edge);\n  } else {\n    markers.splice(index, 0, edge);\n  }\n  const enoughPoints = markers.length >= 3;\n  if (this.phase === 'draw') {\n    if (!enoughPoints) {\n      markers.forEach(({ marker }) => {\n        const icon = marker.getIcon();\n        icon.options.className = cls('area-select-marker', 'invalid');\n        marker.setIcon(icon);\n      });\n    } else if (markers.length === 3) {\n      // Restore colors\n      markers.forEach(({ marker }, index) => {\n        const icon = marker.getIcon();\n        icon.options.className = cls('area-select-marker', index === 0 ? 'start-marker' : null);\n        marker.setIcon(icon);\n      });\n    }\n  }\n  map.fire('as:update-polygon');\n  if (this.phase === 'adjust') {\n    map.fire('as:update-ghost-points');\n    this.onPolygonReady();\n  }\n\n  if (this.phase === 'draw') {\n    // close line\n    if (this.closeLine) {\n      map.removeLayer(this.closeLine);\n    }\n    if (enoughPoints) {\n      this.closeLine = new Polyline(\n        [markers[0].marker.getLatLng(), markers[markers.length - 1].marker.getLatLng()],\n        {\n          weight: 3,\n          color: '#c0c0c0',\n          className: 'areaCloseLine',\n        }\n      );\n      map.addLayer(this.closeLine);\n    }\n  }\n}\n\nexport function onRemoveMarker({ index = 0 }) {\n  const map = this.getMap();\n  const { markers } = this;\n  const enoughPoints = markers.length > 3;\n  if (!enoughPoints) {\n    return;\n  }\n  const removed = this.markers.splice(index || 0, 1);\n  removed[0].marker.removeFrom(map);\n  map.fire('as:update-polygon');\n  if (this.phase === 'adjust') {\n    map.fire('as:update-ghost-points');\n  }\n  for (let i = index; i < this.markers.length; i++) {\n    this.markers[i].marker.off('drag');\n    this.markers[i].marker.on('drag', onMarkerDrag.bind(this)(i));\n    this.markers[i].marker.off(CLICK_EVT);\n    this.markers[i].marker.on(CLICK_EVT, doNothingHandler);\n    this.markers[i].marker.off('dblclick');\n    this.markers[i].marker.on('dblclick', (event) => {\n      event.originalEvent.stopPropagation();\n      map.fire('as:marker-remove', {\n        ...this.markers[i],\n        index: i,\n      });\n    });\n  }\n  this.onPolygonReady();\n}\n\n/**\n * Refresh the polygon on the map\n */\nexport function onUpdatePolygon() {\n  const map = this.getMap();\n  const { markers } = this;\n  const enoughPoints = markers.length >= 3;\n  const polygon = new Polygon(\n    markers.map(({ marker }) => {\n      return marker.getLatLng();\n      // return map.containerPointToLatLng(point);\n    }),\n    {\n      color: enoughPoints ? 'rgb(45, 123, 200)' : 'rgba(220, 53, 69, 0.7)',\n      weight: 2,\n      ...(!enoughPoints && { dashArray: '5, 10' }),\n      className: 'drawing-area-poligon',\n    }\n  );\n  polygon.on(CLICK_EVT, (ev) => {\n    DomEvent.stopPropagation(ev);\n  });\n\n  polygon.on('dblclick', (ev) => {\n    // Preventing zoom-on-doubleclick is not working. I'll leave hacky workarounds to user's implementation\n    // See https://stackoverflow.com/questions/15406537/disable-map-zoom-on-circlemarker-double-click-in-leaflet\n    DomEvent.stopPropagation(ev);\n    this.onPolygonDblClick(ev);\n    return false;\n  });\n  if (this.polygon) {\n    map.removeLayer(this.polygon);\n  }\n  this.polygon = polygon;\n  map.addLayer(this.polygon);\n}\n\nexport function onUpdateGhostPoints() {\n  const map = this.getMap();\n  requestAnimationFrame(() => {\n    this.clearGhostMarkers();\n    const { markers, ghostMarkers } = this;\n    markers.forEach((currentMarker, index) => {\n      const nextMarker = markers[index + 1] ? markers[index + 1] : markers[0];\n      const currentLatLng = currentMarker.marker.getLatLng();\n      const nextLatLng = nextMarker.marker.getLatLng();\n      const point = map.latLngToContainerPoint([\n        (currentLatLng.lat + nextLatLng.lat) / 2,\n        (currentLatLng.lng + nextLatLng.lng) / 2,\n      ]);\n\n      const icon = new DivIcon({\n        className: cls('area-select-ghost-marker'),\n        iconSize: [16, 16],\n      });\n      const marker = new Marker(map.containerPointToLatLng(point), {\n        icon,\n        draggable: true,\n      });\n      const newGhostMarker = {\n        marker,\n      };\n      marker.on(CLICK_EVT, doNothingHandler);\n      marker.on('dblclick', doNothingHandler);\n      marker.on('dragstart', onGhostMarkerDragStart.bind(this)());\n      marker.on('drag', onGhostMarkerDrag.bind(this)(ghostMarkers.length));\n      marker.on('dragend', onGhostMarkerDragEnd.bind(this)(ghostMarkers.length));\n      ghostMarkers.push(newGhostMarker);\n      marker.addTo(map);\n    });\n  });\n}\n\nexport function onPolygonCreationEnd() {\n  const map = this.getMap();\n  // We'll forcly enable the drag on the map (which will be just of the draw pane)\n  map.dragging.enable();\n  map.removeLayer(this.closeLine);\n  this.closeLine = null;\n  // Remove style for the final marker icon\n  this.markers[0].marker.getElement().classList.remove('start-marker');\n  this.setPhase('adjust');\n  map.fire('as:update-ghost-points');\n  this.onPolygonReady();\n  removeEndClickArea(this);\n}\n\n/**\n * Plugin activation (button pressed)\n */\nexport function onActivate(event) {\n  // Non-sense, but required on Safari. Probably related to https://github.com/Leaflet/Leaflet/issues/7255\n  if (!isTrustedEvent(event)) {\n    return;\n  }\n  const map = this.getMap();\n  // storing if the dragging is enabled in the map\n  this._dragStatus = map.dragging._enabled;\n\n  // Let leave to custom callback any call to preventDefault, which will block normal button behaviors\n  // event.preventDefault();\n  event.stopPropagation();\n  event.target.blur();\n  // if current state is active, we need to deactivate\n  const activeState = this.options.active || this.phase === 'adjust';\n  if (activeState) {\n    // Disable dragging if it was enabled before the activation\n    if (!this._dragStatus) {\n      map.dragging.disable();\n    }\n\n    // Calling user's specific event handler\n    this.options.onButtonDeactivate(this.polygon, this, event);\n    if (!event.defaultPrevented) {\n      this.deactivate();\n    }\n  } else {\n    // Calling user's specific event handler\n    this.options.onButtonActivate(this, event);\n    if (!event.defaultPrevented) {\n      this.activate();\n    }\n  }\n}\n\nexport function onMarkerDrag(index) {\n  const map = this.getMap();\n  return (event) => {\n    requestAnimationFrame(() => {\n      map.fire('as:update-polygon');\n      map.fire('as:update-ghost-points');\n    });\n  };\n}\n\nexport function onGhostMarkerDrag(index) {\n  const map = this.getMap();\n  return (event) => {\n    const { latlng } = event;\n    requestAnimationFrame(() => {\n      // Given a ghost point, markers to be used as edges are the one at +0 and +1\n      const firstPoint = this.markers[index];\n      const lastPoint = this.markers[index + 1] ? this.markers[index + 1] : this.markers[0];\n      if (this.ghostPolygon) {\n        map.removeLayer(this.ghostPolygon);\n      }\n      this.ghostPolygon = new Polygon(\n        [firstPoint.marker.getLatLng(), latlng, lastPoint.marker.getLatLng()],\n        {\n          color: 'rgb(45, 123, 200)',\n          weight: 2,\n          opacity: 0.5,\n          fillOpacity: 0.1,\n          dashArray: '5, 10',\n        }\n      );\n      map.addLayer(this.ghostPolygon);\n      map.fire('as:update-polygon');\n    });\n  };\n}\n\nexport function onGhostMarkerDragStart() {\n  return (event) => {\n    event.target.getElement().classList.add('active');\n  };\n}\n\nexport function onGhostMarkerDragEnd(index) {\n  const map = this.getMap();\n  return (event) => {\n    const { target } = event;\n    target.getElement().classList.remove('active');\n    target.removeFrom(map);\n    if (this.ghostPolygon) {\n      map.removeLayer(this.ghostPolygon);\n    }\n    const newPoint = map.latLngToContainerPoint(target.getLatLng());\n    const container = map.getContainer();\n    const bbox = container.getBoundingClientRect();\n    const fakeEvent = {\n      clientX: newPoint.x + bbox.left,\n      clientY: newPoint.y + bbox.top,\n      index: index + 1,\n    };\n    map.fire('as:point-add', fakeEvent);\n  };\n}\n\nexport function onMouseMove(event) {\n  if (!this.mapMoving && this.markers.length === 0 && event.which !== 0 && event.buttons === 1) {\n    const map = this.getMap();\n    if (!this.rectDrawing) {\n      this.rectDrawStart = [event.clientX, event.clientY];\n      const props = {\n        weight: 2,\n        color: '#8B4513',\n        className: 'rect-progress-line',\n        opacity: 0.6,\n      };\n      this.draggingRect = new LayerGroup()\n        .addLayer(new Polyline([], props))\n        .addLayer(new Polyline([], props))\n        .addTo(map);\n      this.rectDrawing = true;\n      return;\n    }\n    this.rectDrawEnd = [event.clientX, event.clientY];\n    const pointA = [this.rectDrawStart[0], event.clientY];\n    const pointB = [event.clientX, this.rectDrawStart[1]];\n\n    const layers = this.draggingRect.getLayers();\n    layers[0].setLatLngs([\n      map.mouseEventToLatLng({ clientX: this.rectDrawEnd[0], clientY: this.rectDrawEnd[1] }),\n      map.mouseEventToLatLng({ clientX: pointA[0], clientY: pointA[1] }),\n      map.mouseEventToLatLng({ clientX: this.rectDrawStart[0], clientY: this.rectDrawStart[1] }),\n    ]);\n    layers[1].setLatLngs([\n      map.mouseEventToLatLng({ clientX: this.rectDrawEnd[0], clientY: this.rectDrawEnd[1] }),\n      map.mouseEventToLatLng({ clientX: pointB[0], clientY: pointB[1] }),\n      map.mouseEventToLatLng({ clientX: this.rectDrawStart[0], clientY: this.rectDrawStart[1] }),\n    ]);\n  }\n}\n\nexport function onDraggingRectEnd() {\n  this.rectDrawing = false;\n  const vertex1 = { clientX: this.rectDrawStart[0], clientY: this.rectDrawStart[1] };\n  const vertex2 = { clientX: this.rectDrawEnd[0], clientY: this.rectDrawStart[1] };\n  const vertex3 = { clientX: this.rectDrawEnd[0], clientY: this.rectDrawEnd[1] };\n  const vertex4 = { clientX: this.rectDrawStart[0], clientY: this.rectDrawEnd[1] };\n  onAddPoint.bind(this)(vertex1);\n  onAddPoint.bind(this)(vertex2);\n  onAddPoint.bind(this)(vertex3);\n  onAddPoint.bind(this)(vertex4);\n  this._map.fire('as:creation-end');\n  this.rectDrawStart = null;\n  this.rectDrawEnd = null;\n  this.draggingRect.removeFrom(this._map);\n}\n","import { DomUtil, Control, Util, Point, Browser } from 'leaflet';\nimport { createPane, removeEndClickArea, PANE_NAME } from './drawing-pane';\nimport { cls, setPosition } from './utils';\nimport {\n  onActivate,\n  onAddMarker,\n  onAddPoint,\n  onDraggingRectEnd,\n  onMouseMove,\n  onPolygonCreationEnd,\n  onRemoveMarker,\n  onUpdateGhostPoints,\n  onUpdatePolygon,\n} from './events';\n\n// import buttonImage from './images/area-icon.png';\n\nexport const DrawAreaSelection = Control.extend({\n  options: {\n    // activate automatically area selection on plugin load\n    active: false,\n    // partially fade the map when draw phase is activated\n    fadeOnActivation: true,\n    /* ******* callbacks ******* */\n    // callback called when draw phase is complete and at every polygon adjustement\n    onPolygonReady: (polygon, control) => {},\n    // callback called when draw phase is complete and double-click is performed on the final polygon\n    onPolygonDblClick: (polygon, control, event) => {},\n    // callback called when user press the activation button\n    onButtonActivate: (control, event) => {},\n    // callback called when user press the button to deactivate (not called when the plugin deactivate itself automatically)\n    onButtonDeactivate: (polygon, control, event) => {},\n  },\n\n  initialize: function (options = {}) {\n    Util.setOptions(this, options);\n    this._map = null;\n    // lifecycle phases: one of inactive, draw, adjust\n    this.phase = options.active ? 'draw' : 'inactive';\n    this.mapMoving = false;\n    // map if in phase of drawing a rectangle\n    this.rectDrawing = false;\n    // where user started to draw a rect\n    this.rectDrawStart = null;\n    this.rectDrawEnd = null;\n    // the dragging rect, composed by two lines\n    this.draggingRect = null;\n    // edge markers used for drawing, next dragging the polygon\n    this.markers = [];\n    // fake markers used for adding rings to the polygon\n    this.ghostMarkers = [];\n    // The actual polygon draw\n    this.polygon = null;\n    // on drawing phase: a line from the last drawn point to the first ones\n    this.closeLine = null;\n\n    this._mapMoveStart = this._mapMoveStart.bind(this);\n    this._mapMoveEnd = this._mapMoveEnd.bind(this);\n    this._handleMouseMove = this._handleMouseMove.bind(this);\n  },\n\n  onAdd: function (map) {\n    this._container = DomUtil.create('div', cls('leaflet-area-selector-control'));\n    this.activateButton = DomUtil.create('button', '', this._container);\n    // this.activateButton.style.backgroundImage = `url('${buttonImage}')`;\n    this.activateButton.setAttribute('aria-label', 'Draw shape');\n    this.activateButton.setAttribute('aria-describedby', 'draw-panel-help');\n    this.activateButton.addEventListener('click', onActivate.bind(this));\n    this.activateButton.addEventListener('dblclick', (event) => {\n      event.stopPropagation();\n    });\n    this.options.active\n      ? this.activateButton.classList.add('active')\n      : this.activateButton.classList.remove('active');\n    this._map = map;\n    const pane = createPane(map, this.options);\n    this.addUserHelpPanel(pane);\n    map.getContainer().addEventListener('mousemove', this._handleMouseMove);\n    map.on('movestart', this._mapMoveStart);\n    map.on('moveend', this._mapMoveEnd);\n    map.on('as:point-add', onAddPoint.bind(this));\n    map.on('as:marker-add', onAddMarker.bind(this));\n    map.on('as:marker-remove', onRemoveMarker.bind(this));\n    map.on('as:creation-end', onPolygonCreationEnd.bind(this));\n    map.on('as:update-polygon', onUpdatePolygon.bind(this));\n    map.on('as:update-ghost-points', onUpdateGhostPoints.bind(this));\n    map.on('as:dragging-rect-end', onDraggingRectEnd.bind(this));\n    return this._container;\n  },\n\n  onRemove: function (map) {\n    map.getContainer().removeEventListener('mousemove', this._handleMouseMove);\n    map.off('movestart', this._mapMoveStart);\n    map.off('moveend', this._mapMoveEnd);\n    map.off('as:point-add');\n    map.off('as:marker-add');\n    map.off('as:marker-remove');\n    map.off('as:creation-end');\n    map.off('as:update-polygon');\n    map.off('as:update-ghost-points');\n    map.off('as:dragging-rect-end');\n  },\n\n  getMap: function () {\n    return this._map;\n  },\n\n  onPolygonReady: function () {\n    this.options.onPolygonReady(this.polygon, this);\n  },\n\n  onPolygonDblClick: function (ev) {\n    this.options.onPolygonDblClick(this.polygon, this, ev);\n  },\n\n  addUserHelpPanel(pane) {\n    const panel = DomUtil.create('div', cls('draw-pane-help'));\n    panel.setAttribute('id', 'draw-panel-help');\n    panel.setAttribute('role', 'tooltip');\n    const help = `Define a polygon by clicking of the map to define vertexes${\n      Browser.mobile ? `.` : ` or click-and-drag to obtain a rectangular shape.`\n    }`;\n    panel.textContent = help;\n\n    pane.appendChild(panel);\n  },\n\n  setPhase(phase, forceClear = false) {\n    this.phase = phase;\n    this.options.active = phase === 'draw';\n    // If we didn't finished to fill a polygon, let's clear all\n    if (forceClear || this.phase === 'draw') {\n      this.clearGhostMarkers();\n      this.clearMarkers();\n      this.clearPolygon();\n    }\n    const pane = this._map.getPane(PANE_NAME);\n    const container = pane.parentNode;\n    this.options.active\n      ? container.classList.remove('inactive')\n      : container.classList.add('inactive');\n  },\n\n  _mapMoveStart: function () {\n    if (!this.options.active) {\n      return;\n    }\n    this.mapMoving = true;\n  },\n\n  _mapMoveEnd: function () {\n    if (!this.options.active) {\n      return;\n    }\n    const map = this._map;\n    requestAnimationFrame(() => {\n      this.mapMoving = false;\n    });\n    // Re-position end of selection HTML element\n    const pane = map.getPane(PANE_NAME);\n    const touchMarker = pane.querySelector('.end-selection-area');\n    if (touchMarker) {\n      const firstMarker = this.markers[0].marker;\n      const bbox = touchMarker.getBoundingClientRect();\n      const point = map.latLngToContainerPoint(firstMarker.getLatLng());\n      setPosition(touchMarker, point, new Point(-bbox.width / 2, -bbox.height / 2));\n    }\n  },\n\n  hoverClosePoint: function (event) {\n    if (this.markers.length > 2 && this.closeLine) {\n      this.closeLine.removeFrom(this._map);\n    }\n  },\n\n  outClosePoint: function (event) {\n    if (this.closeLine) {\n      this.closeLine.addTo(this._map);\n    }\n  },\n\n  clearMarkers: function () {\n    this.markers.forEach(({ marker }) => {\n      marker.removeFrom(this._map);\n    });\n    this.markers = [];\n  },\n\n  clearGhostMarkers: function () {\n    this.ghostMarkers.forEach(({ marker }) => {\n      marker.removeFrom(this._map);\n    });\n    this.ghostMarkers = [];\n  },\n\n  clearPolygon: function () {\n    this.polygon && this.polygon.removeFrom(this._map);\n    this.polygon = null;\n    this.closeLine && this.closeLine.removeFrom(this._map);\n    this.closeLine = null;\n  },\n\n  deactivate: function () {\n    removeEndClickArea(this);\n    this.activateButton.classList.remove('active');\n    this._map.getContainer().classList.remove('drawing-area');\n    this.setPhase('inactive', true);\n  },\n\n  activate: function () {\n    // When activating the plugin we'll disable dragging temporarely (in case we are drawing a rect)\n    this._map.dragging.disable();\n    this.activateButton.classList.add('active');\n    this._map.getContainer().classList.add('drawing-area');\n    this.setPhase('draw', true);\n  },\n\n  _handleMouseMove: function (event) {\n    if (!this.options.active) {\n      return;\n    }\n    onMouseMove.bind(this)(event);\n  },\n});\n\nexport const drawAreaSelection = function (options = {}) {\n  return new DrawAreaSelection(options);\n};\n","import { Util, Control } from 'leaflet';\nimport { DrawAreaSelection, drawAreaSelection } from './control';\n\nUtil.extend(Control, {\n  DrawAreaSelection,\n  drawAreaSelection,\n});\n\nexport { DrawAreaSelection, drawAreaSelection };\n"],"names":["toCamelCase","name","split","map","s","index","toUpperCase","substring","join","cls","additionalClasses","clsName","styles","insertAfter","newNode","referenceNode","parentNode","insertBefore","nextSibling","setPosition","el","point","offset","nextPoint","add","_leaflet_pos","Browser","any3d","DomUtil","setTransform","style","left","x","top","y","CLICK_EVT","mobile","isTrustedEvent","event","isTrusted","window","Cypress","PANE_NAME","drawingPaneContainer","options","active","fadeOnActivation","drawPane","create","createPane","standardPanesContainer","getContainer","querySelector","overlayPanesContainer","pane","handler","stopPropagation","fire","addEventListener","addEndClickArea","control","getMap","getPane","marker","bbox","getBoundingClientRect","setAttribute","once","hoverClosePoint","bind","outClosePoint","Point","width","height","removeEndClickArea","remove","doNothingHandler","originalEvent","preventDefault","onAddPoint","mapMoving","clientX","clientY","undefined","touch","changedTouches","rectDrawing","rectDrawEnd","container","markers","length","icon","DivIcon","className","iconSize","Marker","containerPointToLatLng","draggable","_onMarkerDrag","onMarkerDrag","on","target","getElement","classList","requestAnimationFrame","onPolygonReady","newEdge","addTo","i","off","onAddMarker","rest","edge","push","splice","enoughPoints","phase","forEach","getIcon","setIcon","closeLine","removeLayer","Polyline","getLatLng","weight","color","addLayer","onRemoveMarker","removed","removeFrom","onUpdatePolygon","polygon","Polygon","dashArray","ev","DomEvent","onPolygonDblClick","onUpdateGhostPoints","clearGhostMarkers","ghostMarkers","currentMarker","nextMarker","currentLatLng","nextLatLng","latLngToContainerPoint","lat","lng","newGhostMarker","onGhostMarkerDragStart","onGhostMarkerDrag","onGhostMarkerDragEnd","onPolygonCreationEnd","dragging","enable","setPhase","onActivate","_dragStatus","_enabled","blur","activeState","disable","onButtonDeactivate","defaultPrevented","deactivate","onButtonActivate","activate","latlng","firstPoint","lastPoint","ghostPolygon","opacity","fillOpacity","newPoint","fakeEvent","onMouseMove","which","buttons","rectDrawStart","props","draggingRect","LayerGroup","pointA","pointB","layers","getLayers","setLatLngs","mouseEventToLatLng","onDraggingRectEnd","vertex1","vertex2","vertex3","vertex4","_map","DrawAreaSelection","Control","extend","initialize","Util","setOptions","_mapMoveStart","_mapMoveEnd","_handleMouseMove","onAdd","_container","activateButton","addUserHelpPanel","onRemove","removeEventListener","panel","help","textContent","appendChild","forceClear","clearMarkers","clearPolygon","touchMarker","firstMarker","drawAreaSelection"],"mappings":"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"}