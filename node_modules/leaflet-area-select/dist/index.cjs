"use strict";/**
 * L.Map.SelectArea - Area selection tool for leaflet
 *
 * @author Alexander Milevski <info@w8r.name>
 * @see https://github.com/w8r/leaflet-area-select
 * @license MIT
 * @preserve
 */const s=require("leaflet");var r=function(){return!0};s.Map.SelectArea=s.Map.BoxZoom.extend({statics:{SELECT_AREA_SELECTED:"selectarea:selected",SELECT_AREA_START:"selectarea:start",SELECT_AREA_TOGGLED:"selectarea:toggled"},options:{shiftKey:!1,ctrlKey:!0,validate:r,autoDisable:!1,cursor:"crosshair"},initialize:function(t,e){s.Util.setOptions(this,e||{}),s.Map.BoxZoom.prototype.initialize.call(this,t),this._validate=null,this._moved=!1,this._autoDisable=!this.options.ctrlKey&&this.options.autoDisable,this._lastLayerPoint=null,this._beforeCursor=null,this.setValidate(this.options.validate),this.setAutoDisable(this.options.autoDisable)},setValidate:function(t){var e=this;return typeof t!="function"&&(t=r),this._validate=function(i){return t.call(e,i)},this},setAutoDisable:function(t){this._autoDisable=!!t},setControlKey:function(t){var e=this._enabled;e&&this.disable(),this.options.ctrlKey=!!t,t&&(this.options.shiftKey=!1),e&&this.enable()},setShiftKey:function(t){var e=this._enabled;e&&this.disable(),this.options.shiftKey=!!t,t&&(this.options.ctrlKey=!1),e&&this.enable()},enable:function(t,e){this.options.shiftKey?this._map.boxZoom&&this._map.boxZoom.disable():this.options.ctrlKey||this._map.dragging.disable(),s.Map.BoxZoom.prototype.enable.call(this),this.options.ctrlKey||this._setCursor(),t&&this.setValidate(t),this.setAutoDisable(e),this._map.fire(s.Map.SelectArea.SELECT_AREA_TOGGLED)},disable:function(){s.Map.BoxZoom.prototype.disable.call(this),this.options.ctrlKey||this._restoreCursor(),this.options.shiftKey?this._map.boxZoom&&this._map.boxZoom.enable():this._map.dragging.enable(),this._map.fire(s.Map.SelectArea.SELECT_AREA_TOGGLED)},addHooks:function(){s.Map.BoxZoom.prototype.addHooks.call(this),s.DomEvent.on(document,"keyup",this._onKeyUp,this).on(document,"keydown",this._onKeyPress,this).on(document,"contextmenu",this._onMouseDown,this).on(window,"blur",this._onBlur,this),this._map.on("dragstart",this._onMouseDown,this)},removeHooks:function(){s.Map.BoxZoom.prototype.removeHooks.call(this),s.DomEvent.off(document,"keyup",this._onKeyUp,this).off(document,"keydown",this._onKeyPress,this).off(document,"contextmenu",this._onMouseDown,this).off(window,"blur",this._onBlur,this),this._map.off("dragstart",this._onMouseDown,this)},_onMouseDown:function(t){if(this._moved=!1,this._lastLayerPoint=null,this.options.shiftKey&&!t.shiftKey||this.options.ctrlKey&&!t.ctrlKey||t.which!==1&&t.button!==1)return!1;s.DomEvent.stop(t);var e=this._map.mouseEventToLayerPoint(t);if(!this._validate(e))return!1;s.DomUtil.disableTextSelection(),s.DomUtil.disableImageDrag(),this._startLayerPoint=e,s.DomEvent.on(document,"mousemove",this._onMouseMove,this).on(document,"mouseup",this._onMouseUp,this).on(document,"keydown",this._onKeyDown,this)},_onMouseMove:function(t){this._moved||(this._box=s.DomUtil.create("div","leaflet-zoom-box",this._pane),s.DomUtil.setPosition(this._box,this._startLayerPoint),this._map.fire(s.Map.SelectArea.SELECT_AREA_START));var e=this._startLayerPoint,i=this._box,o=this._map.mouseEventToLayerPoint(t),a=o.subtract(e);if(this._validate(o)){this._lastLayerPoint=o;var n=new s.Point(Math.min(o.x,e.x),Math.min(o.y,e.y));s.DomUtil.setPosition(i,n),this._moved=!0,i.style.width=Math.max(0,Math.abs(a.x)-4)+"px",i.style.height=Math.max(0,Math.abs(a.y)-4)+"px"}},_onKeyUp:function(t){t.keyCode===27?this._moved&&this._box&&this._finish():this.options.ctrlKey&&(this._restoreCursor(),this._map.dragging.enable())},_onKeyPress:function(t){this.options.ctrlKey&&(t.ctrlKey||t.type==="dragstart")&&this._beforeCursor===null&&(this._setCursor(),this._map.dragging._draggable._onUp(t),this._map.dragging.disable())},_onBlur:function(t){this._restoreCursor(),this._map.dragging.enable()},_setCursor:function(){this._beforeCursor=this._container.style.cursor,this._container.style.cursor=this.options.cursor},_restoreCursor:function(){this._container.style.cursor=this._beforeCursor,this._beforeCursor=null},_onMouseUp:function(t){this._finish();var e=this._map,i=this._lastLayerPoint;if(!(!i||this._startLayerPoint.equals(i))){s.DomEvent.stop(t);var o=e.layerPointToLatLng(this._startLayerPoint),a=e.layerPointToLatLng(i),n=new s.LatLngBounds(o,a);this._autoDisable?this.disable():this._restoreCursor(),this._moved=!1,s.Util.requestAnimFrame(function(){e.fire(s.Map.SelectArea.SELECT_AREA_SELECTED,{bounds:n,start:o,end:a})})}}});s.Map.mergeOptions({selectArea:!1});s.Map.addInitHook("addHandler","selectArea",s.Map.SelectArea);const h=s.Map.SelectArea;module.exports=h;
