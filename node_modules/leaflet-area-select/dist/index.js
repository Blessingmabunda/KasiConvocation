(function(t,n){typeof exports=="object"&&typeof module<"u"?module.exports=n(require("leaflet")):typeof define=="function"&&define.amd?define(["leaflet"],n):(t=typeof globalThis<"u"?globalThis:t||self,t.L=t.L||{},t.L.Map=t.L.Map||{},t.L.Map.SelectArea=n(t.L))})(this,function(t){"use strict";/**
 * L.Map.SelectArea - Area selection tool for leaflet
 *
 * @author Alexander Milevski <info@w8r.name>
 * @see https://github.com/w8r/leaflet-area-select
 * @license MIT
 * @preserve
 */var n=function(){return!0};return t.Map.SelectArea=t.Map.BoxZoom.extend({statics:{SELECT_AREA_SELECTED:"selectarea:selected",SELECT_AREA_START:"selectarea:start",SELECT_AREA_TOGGLED:"selectarea:toggled"},options:{shiftKey:!1,ctrlKey:!0,validate:n,autoDisable:!1,cursor:"crosshair"},initialize:function(e,i){t.Util.setOptions(this,i||{}),t.Map.BoxZoom.prototype.initialize.call(this,e),this._validate=null,this._moved=!1,this._autoDisable=!this.options.ctrlKey&&this.options.autoDisable,this._lastLayerPoint=null,this._beforeCursor=null,this.setValidate(this.options.validate),this.setAutoDisable(this.options.autoDisable)},setValidate:function(e){var i=this;return typeof e!="function"&&(e=n),this._validate=function(s){return e.call(i,s)},this},setAutoDisable:function(e){this._autoDisable=!!e},setControlKey:function(e){var i=this._enabled;i&&this.disable(),this.options.ctrlKey=!!e,e&&(this.options.shiftKey=!1),i&&this.enable()},setShiftKey:function(e){var i=this._enabled;i&&this.disable(),this.options.shiftKey=!!e,e&&(this.options.ctrlKey=!1),i&&this.enable()},enable:function(e,i){this.options.shiftKey?this._map.boxZoom&&this._map.boxZoom.disable():this.options.ctrlKey||this._map.dragging.disable(),t.Map.BoxZoom.prototype.enable.call(this),this.options.ctrlKey||this._setCursor(),e&&this.setValidate(e),this.setAutoDisable(i),this._map.fire(t.Map.SelectArea.SELECT_AREA_TOGGLED)},disable:function(){t.Map.BoxZoom.prototype.disable.call(this),this.options.ctrlKey||this._restoreCursor(),this.options.shiftKey?this._map.boxZoom&&this._map.boxZoom.enable():this._map.dragging.enable(),this._map.fire(t.Map.SelectArea.SELECT_AREA_TOGGLED)},addHooks:function(){t.Map.BoxZoom.prototype.addHooks.call(this),t.DomEvent.on(document,"keyup",this._onKeyUp,this).on(document,"keydown",this._onKeyPress,this).on(document,"contextmenu",this._onMouseDown,this).on(window,"blur",this._onBlur,this),this._map.on("dragstart",this._onMouseDown,this)},removeHooks:function(){t.Map.BoxZoom.prototype.removeHooks.call(this),t.DomEvent.off(document,"keyup",this._onKeyUp,this).off(document,"keydown",this._onKeyPress,this).off(document,"contextmenu",this._onMouseDown,this).off(window,"blur",this._onBlur,this),this._map.off("dragstart",this._onMouseDown,this)},_onMouseDown:function(e){if(this._moved=!1,this._lastLayerPoint=null,this.options.shiftKey&&!e.shiftKey||this.options.ctrlKey&&!e.ctrlKey||e.which!==1&&e.button!==1)return!1;t.DomEvent.stop(e);var i=this._map.mouseEventToLayerPoint(e);if(!this._validate(i))return!1;t.DomUtil.disableTextSelection(),t.DomUtil.disableImageDrag(),this._startLayerPoint=i,t.DomEvent.on(document,"mousemove",this._onMouseMove,this).on(document,"mouseup",this._onMouseUp,this).on(document,"keydown",this._onKeyDown,this)},_onMouseMove:function(e){this._moved||(this._box=t.DomUtil.create("div","leaflet-zoom-box",this._pane),t.DomUtil.setPosition(this._box,this._startLayerPoint),this._map.fire(t.Map.SelectArea.SELECT_AREA_START));var i=this._startLayerPoint,s=this._box,o=this._map.mouseEventToLayerPoint(e),a=o.subtract(i);if(this._validate(o)){this._lastLayerPoint=o;var r=new t.Point(Math.min(o.x,i.x),Math.min(o.y,i.y));t.DomUtil.setPosition(s,r),this._moved=!0,s.style.width=Math.max(0,Math.abs(a.x)-4)+"px",s.style.height=Math.max(0,Math.abs(a.y)-4)+"px"}},_onKeyUp:function(e){e.keyCode===27?this._moved&&this._box&&this._finish():this.options.ctrlKey&&(this._restoreCursor(),this._map.dragging.enable())},_onKeyPress:function(e){this.options.ctrlKey&&(e.ctrlKey||e.type==="dragstart")&&this._beforeCursor===null&&(this._setCursor(),this._map.dragging._draggable._onUp(e),this._map.dragging.disable())},_onBlur:function(e){this._restoreCursor(),this._map.dragging.enable()},_setCursor:function(){this._beforeCursor=this._container.style.cursor,this._container.style.cursor=this.options.cursor},_restoreCursor:function(){this._container.style.cursor=this._beforeCursor,this._beforeCursor=null},_onMouseUp:function(e){this._finish();var i=this._map,s=this._lastLayerPoint;if(!(!s||this._startLayerPoint.equals(s))){t.DomEvent.stop(e);var o=i.layerPointToLatLng(this._startLayerPoint),a=i.layerPointToLatLng(s),r=new t.LatLngBounds(o,a);this._autoDisable?this.disable():this._restoreCursor(),this._moved=!1,t.Util.requestAnimFrame(function(){i.fire(t.Map.SelectArea.SELECT_AREA_SELECTED,{bounds:r,start:o,end:a})})}}}),t.Map.mergeOptions({selectArea:!1}),t.Map.addInitHook("addHandler","selectArea",t.Map.SelectArea),t.Map.SelectArea});
